<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Pagamentos</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    padding: 20px;
}
.container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    max-width: 1200px;
    margin: auto;
}
.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
    gap: 10px;
    margin: 20px 0;
}
.stat {
    background: #f8f9fa;
    border-left: 5px solid #667eea;
    padding: 12px;
    text-align: center;
}
.stat h4 {
    margin: 0;
    font-size: 14px;
    color: #666;
}
.stat span {
    font-size: 22px;
    font-weight: bold;
}
table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 8px;
    border: 1px solid #ddd;
    text-align: center;
    font-size: 14px;
}
th {
    background: #667eea;
    color: white;
}
select[data-status="Pago"] {
    background: #d4edda;
}
select[data-status="Pendente"] {
    background: #f8d7da;
}
select:disabled, input:disabled {
    opacity: 0.7;
    cursor: not-allowed;
}
.btn-unlock {
    background: #ffc107;
    border: none;
    padding: 5px 8px;
    cursor: pointer;
}
.valor {
    font-weight: bold;
}
</style>
</head>

<body>

<div class="container">
    <h2>ðŸ“Š Controle de Pagamentos</h2>

    <!-- RESUMO FINANCEIRO -->
    <div class="stats" id="stats"></div>

    <table>
        <thead>
        <tr>
            <th>Parcela</th>
            <th>Vencimento</th>
            <th>Total</th>
            <th>Fernando</th>
            <th>Vitor</th>
            <th>SebastiÃ£o</th>
            <th>Status</th>
            <th>Data</th>
            <th>AÃ§Ã£o</th>
        </tr>
        </thead>
        <tbody id="tabela"></tbody>
    </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// ðŸ”¥ CONFIGURE COM SEU FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCjs2EU9JuVHTxI0ZNIszAdH3mdF7obGnA",
  authDomain: "controle-pagamentos-3759d.firebaseapp.com",
  projectId: "controle-pagamentos-3759d",
  storageBucket: "controle-pagamentos-3759d.firebasestorage.app",
  messagingSenderId: "219928011798",
  appId: "1:219928011798:web:7946650d61cf0bc2528137"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ================= CONFIGURAÃ‡Ã•ES =================
const SENHA = "solar";
const TOTAL_PARCELAS = 48;
const DATA_INICIO = new Date(2026, 1, 27);

const VALORES_BASE = {
    fernando: 300,
    vitor: 300,
    sebastiao: 200
};
const ACRESCIMO = 18;
const PARCELAS_COM_ACRESCIMO = 4;

// ================= ESTADO GLOBAL =================
let estadoPagamentos = [];

// ================= FUNÃ‡Ã•ES =================
function valoresParcela(i) {
    const extra = i < PARCELAS_COM_ACRESCIMO ? ACRESCIMO : 0;
    const fernando = VALORES_BASE.fernando + extra;
    const vitor = VALORES_BASE.vitor + extra;
    const sebastiao = VALORES_BASE.sebastiao + extra;
    return {
        fernando,
        vitor,
        sebastiao,
        total: fernando + vitor + sebastiao
    };
}

function gerarTabela() {
    const tbody = document.getElementById("tabela");
    tbody.innerHTML = "";

    for (let i = 0; i < TOTAL_PARCELAS; i++) {
        const d = new Date(DATA_INICIO);
        d.setMonth(d.getMonth() + i);
        const v = valoresParcela(i);

        tbody.innerHTML += `
            <tr>
                <td>${String(i+1).padStart(2,"0")}/${TOTAL_PARCELAS}</td>
                <td>${d.toLocaleDateString("pt-BR")}</td>
                <td class="valor">R$ ${v.total.toFixed(2).replace(".",",")}</td>
                <td>R$ ${v.fernando.toFixed(2).replace(".",",")}</td>
                <td>R$ ${v.vitor.toFixed(2).replace(".",",")}</td>
                <td>R$ ${v.sebastiao.toFixed(2).replace(".",",")}</td>
                <td>
                    <select data-i="${i}" onchange="pagar(${i}, this.value)">
                        <option>Pendente</option>
                        <option>Pago</option>
                    </select>
                </td>
                <td><input type="date" data-i="${i}"></td>
                <td><button class="btn-unlock" onclick="desbloquear(${i})">ðŸ”“</button></td>
            </tr>`;
    }
}

function iniciarListenerFirestore() {
    db.collection("pagamentos")
      .doc("parcelas")
      .onSnapshot(doc => {
          if (!doc.exists) return;

          estadoPagamentos = doc.data().dados || [];

          estadoPagamentos.forEach((p, i) => {
              const s = document.querySelector(`select[data-i="${i}"]`);
              const d = document.querySelector(`input[data-i="${i}"]`);
              if (!s || !d) return;

              s.value = p.status;
              s.setAttribute("data-status", p.status);
              d.value = p.data || "";
              s.disabled = p.bloqueado;
              d.disabled = p.bloqueado;
          });

          atualizarResumo();
      });
}

async function salvar() {
    estadoPagamentos = [];

    for (let i = 0; i < TOTAL_PARCELAS; i++) {
        const s = document.querySelector(`select[data-i="${i}"]`);
        const d = document.querySelector(`input[data-i="${i}"]`);
        estadoPagamentos.push({
            status: s.value,
            data: d.value,
            bloqueado: s.disabled
        });
    }

    await db.collection("pagamentos")
            .doc("parcelas")
            .set({ dados: estadoPagamentos });
}

function pagar(i, status) {
    if (status === "Pago") {
        if (prompt("Senha:") !== SENHA) return;

        const s = document.querySelector(`select[data-i="${i}"]`);
        const d = document.querySelector(`input[data-i="${i}"]`);

        d.value = new Date().toISOString().split("T")[0];
        s.disabled = true;
        d.disabled = true;
        s.setAttribute("data-status","Pago");

        salvar();
    }
}

function desbloquear(i) {
    if (prompt("Senha:") !== SENHA) return;

    const s = document.querySelector(`select[data-i="${i}"]`);
    const d = document.querySelector(`input[data-i="${i}"]`);

    s.disabled = false;
    d.disabled = false;
    s.value = "Pendente";
    d.value = "";
    s.setAttribute("data-status","Pendente");

    salvar();
}

function atualizarResumo() {
    let pagos = 0;
    let totalPago = 0;

    estadoPagamentos.forEach((p,i)=>{
        if (p.status === "Pago") {
            pagos++;
            totalPago += valoresParcela(i).total;
        }
    });

    document.getElementById("stats").innerHTML = `
        <div class="stat"><h4>Parcelas Pagas</h4><span>${pagos}</span></div>
        <div class="stat"><h4>Parcelas Pendentes</h4><span>${TOTAL_PARCELAS - pagos}</span></div>
        <div class="stat"><h4>Total Pago</h4><span>R$ ${totalPago.toLocaleString("pt-BR",{minimumFractionDigits:2})}</span></div>
        <div class="stat"><h4>Progresso</h4><span>${Math.round((pagos/TOTAL_PARCELAS)*100)}%</span></div>
    `;
}

// ================= INICIALIZAÃ‡ÃƒO =================
window.onload = () => {
    gerarTabela();
    iniciarListenerFirestore();
};
</script>

</body>
</html>
