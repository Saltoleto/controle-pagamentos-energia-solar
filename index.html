<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Pagamentos</title>

<style>
* {
    box-sizing: border-box;
    max-width: 100%;
}

body {
    margin: 0;
    padding: 10px;
    font-family: Arial, sans-serif;
    background: #f2f2f2;
}

.container {
    background: #fff;
    border-radius: 8px;
    padding: 12px;
    max-width: 1200px;
    margin: auto;
}

h2 {
    text-align: center;
    margin-bottom: 10px;
}

/* ===== RESUMO ===== */
.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 8px;
    margin-bottom: 12px;
}

.stat {
    background: #f8f9fa;
    border-left: 4px solid #667eea;
    padding: 8px;
    border-radius: 4px;
    text-align: center;
}

.stat h4 {
    margin: 0;
    font-size: 12px;
    color: #666;
}

.stat span {
    font-size: 18px;
    font-weight: bold;
}

/* ===== TABELA / CARDS ===== */
table {
    width: 100%;
    border-collapse: collapse;
}

thead {
    display: none;
}

tr.card-parcela {
    display: block;
    background: #fafafa;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 12px;
}

td {
    display: block;
    padding: 0;
}

/* ===== BLOCOS ===== */
.bloco {
    padding: 10px;
    border-bottom: 1px solid #eee;
}

.bloco:last-child {
    border-bottom: none;
}

.valores div {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
}

.valores .total {
    margin-top: 6px;
    font-weight: bold;
    border-top: 1px dashed #ccc;
    padding-top: 4px;
}

/* ===== INPUTS ===== */
select, input, button {
    width: 100%;
    padding: 8px;
    margin-top: 6px;
    font-size: 14px;
}

input[readonly] {
    background: #e9ecef;
    cursor: not-allowed;
}

select[data-status="Pago"] {
    background: #d4edda;
}

select[data-status="Pendente"] {
    background: #f8d7da;
}

select:disabled {
    opacity: 0.7;
}

.btn-unlock {
    background: #ffc107;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

/* ===== DESKTOP ===== */
@media (min-width: 900px) {

    thead {
        display: table-header-group;
    }

    tr.card-parcela {
        display: table-row;
        background: #fff;
    }

    td {
        display: table-cell;
        padding: 8px;
        border: 1px solid #ddd;
        text-align: center;
        vertical-align: middle;
    }

    .bloco {
        border: none;
        padding: 0;
    }

    .valores div {
        display: block;
        font-size: 14px;
    }
}
</style>
</head>

<body>

<div class="container">
    <h2>ðŸ“Š Controle de Pagamentos</h2>

    <div class="stats" id="stats"></div>

    <table>
        <thead>
        <tr>
            <th>Parcela</th>
            <th>Vencimento</th>
            <th>Valores</th>
            <th>Status</th>
            <th>Data</th>
            <th>AÃ§Ã£o</th>
        </tr>
        </thead>
        <tbody id="tabela"></tbody>
    </table>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
// ===== FIREBASE =====
const firebaseConfig = {
  apiKey: "AIzaSyCjs2EU9JuVHTxI0ZNIszAdH3mdF7obGnA",
  authDomain: "controle-pagamentos-3759d.firebaseapp.com",
  projectId: "controle-pagamentos-3759d",
  storageBucket: "controle-pagamentos-3759d.firebasestorage.app",
  messagingSenderId: "219928011798",
  appId: "1:219928011798:web:7946650d61cf0bc2528137"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ===== CONFIG =====
const SENHA = "solar";
const TOTAL_PARCELAS = 48;
const DATA_INICIO = new Date(2026, 1, 27);

const VALORES_BASE = {
    fernando: 300,
    vitor: 300,
    sebastiao: 200
};

const ACRESCIMO = 18;
const PARCELAS_COM_ACRESCIMO = 4;

let estadoPagamentos = [];

// ===== FUNÃ‡Ã•ES =====
function valoresParcela(i) {
    const extra = i < PARCELAS_COM_ACRESCIMO ? ACRESCIMO : 0;
    const f = VALORES_BASE.fernando + extra;
    const v = VALORES_BASE.vitor + extra;
    const s = VALORES_BASE.sebastiao + extra;
    return { fernando: f, vitor: v, sebastiao: s, total: f + v + s };
}

function gerarTabela() {
    const tbody = document.getElementById("tabela");
    tbody.innerHTML = "";

    for (let i = 0; i < TOTAL_PARCELAS; i++) {
        const d = new Date(DATA_INICIO);
        d.setMonth(d.getMonth() + i);
        const v = valoresParcela(i);

        tbody.innerHTML += `
        <tr class="card-parcela">
            <td>
                <div class="bloco">
                    <strong>ðŸ“… Parcela ${String(i+1).padStart(2,"0")}/${TOTAL_PARCELAS}</strong>
                    Vencimento: ${d.toLocaleDateString("pt-BR")}
                </div>
            </td>

            <td>
                <div class="bloco valores">
                    <div>Fernando <span>R$ ${v.fernando.toFixed(2).replace(".",",")}</span></div>
                    <div>Vitor <span>R$ ${v.vitor.toFixed(2).replace(".",",")}</span></div>
                    <div>SebastiÃ£o <span>R$ ${v.sebastiao.toFixed(2).replace(".",",")}</span></div>
                    <div class="total">Total <span>R$ ${v.total.toFixed(2).replace(".",",")}</span></div>
                </div>
            </td>

            <td>
                <div class="bloco">
                    <select data-i="${i}" onchange="pagar(${i}, this.value)">
                        <option>Pendente</option>
                        <option>Pago</option>
                    </select>
                </div>
            </td>

            <td>
                <div class="bloco">
                    <input type="date" data-i="${i}" readonly>
                </div>
            </td>

            <td>
                <div class="bloco">
                    <button class="btn-unlock" onclick="desbloquear(${i})">ðŸ”“ Desbloquear</button>
                </div>
            </td>
        </tr>`;
    }
}

function iniciarListenerFirestore() {
    db.collection("pagamentos").doc("parcelas").onSnapshot(doc => {
        if (!doc.exists) return;
        estadoPagamentos = doc.data().dados || [];

        estadoPagamentos.forEach((p,i)=>{
            const s = document.querySelector(`select[data-i="${i}"]`);
            const d = document.querySelector(`input[data-i="${i}"]`);
            if(!s||!d) return;

            s.value = p.status;
            s.setAttribute("data-status", p.status);
            s.disabled = p.bloqueado;
            d.value = p.data || "";
        });

        atualizarResumo();
    });
}

async function salvar() {
    estadoPagamentos = [];
    for (let i = 0; i < TOTAL_PARCELAS; i++) {
        const s = document.querySelector(`select[data-i="${i}"]`);
        const d = document.querySelector(`input[data-i="${i}"]`);
        estadoPagamentos.push({
            status: s.value,
            data: d.value,
            bloqueado: s.disabled
        });
    }
    await db.collection("pagamentos").doc("parcelas").set({ dados: estadoPagamentos });
}

function pagar(i,status) {
    if(status==="Pago"){
        if(prompt("Senha:")!==SENHA) return;
        const s=document.querySelector(`select[data-i="${i}"]`);
        const d=document.querySelector(`input[data-i="${i}"]`);
        d.value=new Date().toISOString().split("T")[0];
        s.disabled=true;
        s.setAttribute("data-status","Pago");
        salvar();
    }
}

function desbloquear(i){
    if(prompt("Senha:")!==SENHA) return;
    const s=document.querySelector(`select[data-i="${i}"]`);
    const d=document.querySelector(`input[data-i="${i}"]`);
    s.disabled=false;
    s.value="Pendente";
    d.value="";
    s.setAttribute("data-status","Pendente");
    salvar();
}

function atualizarResumo(){
    let pagos=0,total=0;
    estadoPagamentos.forEach((p,i)=>{
        if(p.status==="Pago"){
            pagos++;
            total+=valoresParcela(i).total;
        }
    });

    document.getElementById("stats").innerHTML=`
        <div class="stat"><h4>Pagas</h4><span>${pagos}</span></div>
        <div class="stat"><h4>Pendentes</h4><span>${TOTAL_PARCELAS-pagos}</span></div>
        <div class="stat"><h4>Total Pago</h4><span>R$ ${total.toLocaleString("pt-BR",{minimumFractionDigits:2})}</span></div>
        <div class="stat"><h4>Progresso</h4><span>${Math.round((pagos/TOTAL_PARCELAS)*100)}%</span></div>
    `;
}

window.onload = () => {
    gerarTabela();
    iniciarListenerFirestore();
};
</script>

</body>
</html>
